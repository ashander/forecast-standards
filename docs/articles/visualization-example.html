<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example of interacting with and visualizing EFI standard data • EFIstandards</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example of interacting with and visualizing EFI standard data">
<meta property="og:description" content="EFIstandards">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EFIstandards</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flare-metadata-example.html">Example metadata for a FLARE forecast</a>
    </li>
    <li>
      <a href="../articles/logistic-metadata-example.html">Example metadata for a Lotka-Volterra population growth forecast</a>
    </li>
    <li>
      <a href="../articles/visualization-example.html">Example of interacting with and visualizing EFI standard data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="visualization-example_files/header-attrs-2.5/header-attrs.js"></script><link href="visualization-example_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="visualization-example_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example of interacting with and visualizing EFI standard data</h1>
            
      
      
      <div class="hidden name"><code>visualization-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/EML/">EML</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/emld/">emld</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">EFIstandards</span><span class="op">)</span></code></pre></div>
<p>Visualizing the simple, example forecast of population growth of two interacting species</p>
<p>========================================================</p>
<div id="parsing-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#parsing-metadata" class="anchor"></a>Parsing metadata</h2>
<p>First load the data using <code>EML</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eml_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"forecast-eml.xml"</span>, package<span class="op">=</span><span class="st">"EFIstandards"</span><span class="op">)</span>
<span class="va">md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/read_eml.html">read_eml</a></span><span class="op">(</span><span class="va">eml_filename</span><span class="op">)</span>  <span class="co">#you could replace the variable here with a filename form a downloaded data package from a repository</span></code></pre></div>
<p>Then to examine the details, use <code><a href="https://docs.ropensci.org/EML/reference/eml_get.html">EML::eml_get</a></code>. First, the title and abstract and who made it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"title"</span><span class="op">)</span></code></pre></div>
<pre><code>## '': A very simple Lotka-Volterra forecast</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"abstract"</span><span class="op">)</span></code></pre></div>
<pre><code>## '': An illustration of how we might use EML metadata to describe an ecological forecast</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"creator"</span><span class="op">)</span></code></pre></div>
<pre><code>## electronicMailAddress: rqthomas@vt.edu
## id: https://orcid.org/0000-0003-1282-7825
## individualName:
##   givenName: Quinn
##   surName: Thomas</code></pre>
<p>Then diving in, the coverage and keywords</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"coverage"</span><span class="op">)</span></code></pre></div>
<pre><code>## geographicCoverage:
##   geographicDescription: 'Lake Sunapee, NH, USA '
##   boundingCoordinates:
##     westBoundingCoordinate: '-72.15'
##     eastBoundingCoordinate: '-72.05'
##     northBoundingCoordinate: '43.48'
##     southBoundingCoordinate: '43.36'
## taxonomicCoverage:
##   taxonomicClassification:
##   - taxonRankName: Genus
##     taxonRankValue: Gloeotrichia
##     taxonomicClassification:
##       taxonRankName: Species
##       taxonRankValue: echinulata
##   - taxonRankName: Genus
##     taxonRankValue: Anabaena
##     taxonomicClassification:
##       taxonRankName: Species
##       taxonRankValue: circinalis
## temporalCoverage:
##   rangeOfDates:
##     beginDate:
##       calendarDate: '2001-03-04'
##     endDate:
##       calendarDate: '2001-04-02'</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"keywordSet"</span><span class="op">)</span></code></pre></div>
<pre><code>## keyword:
## - forecast
## - population
## - timeseries
## keywordThesaurus: EFI controlled vocabulary</code></pre>
<p>Looks like it’s a population level timeseries forecast of Lake Sunapee, NH, USA for two species:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># these seem a bit of a pain to pull out maybe there's an easier way</span>
<span class="va">spps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"taxonRankValue"</span><span class="op">)</span>
<span class="va">sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">spps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span>
<span class="va">sp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">spps</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span>
<span class="va">sp1</span></code></pre></div>
<pre><code>## [1] "Gloeotrichia echinulata"</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sp2</span></code></pre></div>
<pre><code>## [1] "Anabaena circinalis"</code></pre>
</div>
<div id="reading-structured-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-structured-methods" class="anchor"></a>Reading structured methods</h2>
<p>Load the additional metadata (see documentation of EFI forecasting standard):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">methods_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"additionalMetadata"</span><span class="op">)</span>
<span class="va">methods_md</span></code></pre></div>
<pre><code>## metadata:
##   forecast:
##     drivers:
##       status: absent
##     forecast_horizon: 30 days
##     forecast_issue_time: '2001-03-04'
##     forecast_iteration_id: 20010304T060000
##     forecast_project_id: LogisticDemo
##     initial_conditions:
##       complexity: '2'
##       status: present
##     metadata_standard_version: '0.3'
##     model_description:
##       forecast_model_id: v0.3
##       name: discrete Lotka–Volterra model
##       repository: https://github.com/eco4cast/EFIstandards/blob/master/vignettes/logistic-metadata-example.Rmd
##       type: process-based
##     obs_error:
##       complexity: '2'
##       covariance: 'FALSE'
##       status: present
##     parameters:
##       complexity: '6'
##       status: present
##     process_error:
##       complexity: '2'
##       covariance: 'FALSE'
##       propagation:
##         size: '10'
##         type: ensemble
##       status: propagates
##     random_effects:
##       status: absent
##     timestep: 1 day</code></pre>
<p>This metadata contains details about the system forecast including number of state variables and parameters, and the methods used, including propagation of uncertainty. For example, details of the treatment of process error in this model are given by</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">methods_md</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="st">"process_error"</span><span class="op">)</span> <span class="co"># note could do this directly on \`md` object</span></code></pre></div>
<pre><code>## complexity: '2'
## covariance: 'FALSE'
## propagation:
##   size: '10'
##   type: ensemble
## status: propagates</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_ensembles</span> <span class="op">&lt;-</span> <span class="va">methods_md</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="st">"process_error"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="st">"size"</span><span class="op">)</span>
<span class="va">n_ensembles</span> <span class="op">&lt;-</span> <span class="va">n_ensembles</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>From this metadata, the output of this forecast should have error propagation via an ensemble of size 10, process error for two state varible dimensions with no covariance between these. Further, one can check if the forecast used data assimilation (no):</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"assimilation"</span><span class="op">)</span></code></pre></div>
<pre><code>## {}</code></pre>
</div>
<div id="output-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#output-metadata" class="anchor"></a>Output metadata</h2>
<p>Finally, I’ll dive into the metadata for the output data itself. Wait, which output data? All we’ve seen so far is metadata!</p>
<p>First remember that EML specifies a tag “physical” for the location of an actual data file. There’s plenty of metadata on the file itself including authentication format, etc</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"dataset"</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">dt_md</span>, <span class="st">"physical"</span><span class="op">)</span></code></pre></div>
<pre><code>## authentication:
##   method: MD5
##   authentication: 4dbe687fa1f5fc0ff789096076eebd78
## dataFormat:
##   textFormat:
##     recordDelimiter: |2+
## 
##     attributeOrientation: column
##     simpleDelimited:
##       fieldDelimiter: ','
## objectName: logistic-forecast-ensemble-multi-variable-multi-depth.csv
## size:
##   unit: bytes
##   size: '110780'</code></pre>
<p>To get the data parse the filename and load it!</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datafilename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">dt_md</span>, <span class="st">"objectName"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co"># this steps are necessary because this is in an R package if you have a downloaded data repository</span>
<span class="co"># you coudl just pass 'datafilename' into read.csv here</span>
<span class="va">datafile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="va">datafilename</span>, package<span class="op">=</span><span class="st">"EFIstandards"</span><span class="op">)</span> 
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">datafile</span>, row.names<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt</span></code></pre></div>
<pre><code>## # A tibble: 1,800 x 8
##    time    depth ensemble obs_flag species_1 species_2 forecast data_assimilati~
##    &lt;chr&gt;   &lt;int&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;int&gt;            &lt;int&gt;
##  1 2001-0~     1        1        1       0.5       0.5        0                0
##  2 2001-0~     3        1        1       0.5       0.5        0                0
##  3 2001-0~     5        1        1       0.5       0.5        0                0
##  4 2001-0~     1        2        1       0.5       0.5        0                0
##  5 2001-0~     3        2        1       0.5       0.5        0                0
##  6 2001-0~     5        2        1       0.5       0.5        0                0
##  7 2001-0~     1        3        1       0.5       0.5        0                0
##  8 2001-0~     3        3        1       0.5       0.5        0                0
##  9 2001-0~     5        3        1       0.5       0.5        0                0
## 10 2001-0~     1        4        1       0.5       0.5        0                0
## # ... with 1,790 more rows</code></pre>
<p>OK! This has the column names and actual data. To understand these column names, recall the output dataset metadata, which was loaded earlier. In particular the <code>attributeList</code> contains fine details like units and definitions for each column:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_md_cols</span> <span class="op">&lt;-</span> <span class="va">dt_md</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="st">"attributeList"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/get_attributes.html">get_attributes</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">dt_md_cols</span><span class="op">$</span><span class="va">attributes</span></code></pre></div>
<pre><code>##       attributeName                        attributeDefinition storageType
## 1              time                          [dimension]{time}        date
## 2             depth            [dimension]{depth in reservior}       float
## 3          ensemble      [dimension]{index of ensemble member}       float
## 4          obs_flag             [dimension]{observation error}       float
## 5         species_1      [variable]{Pop. density of species 1}       float
## 6         species_2      [variable]{Pop. density of species 2}       float
## 7          forecast [flag]{whether time step assimilated data}       float
## 8 data_assimilation [flag]{whether time step assimilated data}       float
##   formatString measurementScale         domain                  unit numberType
## 1   YYYY-MM-DD         dateTime dateTimeDomain                  &lt;NA&gt;       &lt;NA&gt;
## 2         &lt;NA&gt;            ratio  numericDomain                 meter       real
## 3         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer
## 4         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer
## 5         &lt;NA&gt;            ratio  numericDomain numberPerMeterSquared       real
## 6         &lt;NA&gt;            ratio  numericDomain numberPerMeterSquared       real
## 7         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer
## 8         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer</code></pre>
<p>Cross-referencing this documentation of EFI forecasting standards, note that <code>data_assimilation</code> column is zeroed out so this performed no data assimilation and <code>forecast</code> column is zeroed out so this was a hindcast. As expected, there are 10 ensemble members in the forecast. As consumer of this type of forecast this is the only way to understand the uncertainty in the forecast.</p>
</div>
<div id="visualizing-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-the-data" class="anchor"></a>Visualizing the data</h1>
<p>The output includes densities (number per meter squared) for both species 1 and species 2. I assume these are in the same order as the entries in <code>taxononmicCoverage</code>: Gloeotrichia echinulata and Anabaena circinalis at several depths measured in meters. Glancing at column <code>depth</code> there are only three depths represented. While reshaping the data, I will rename columns with useful information about their units and construct a categorical variable with the actual species names:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>, values_to<span class="op">=</span><span class="st">"density (m^-2)"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,
         name<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">name</span>, species_1<span class="op">=</span><span class="va">sp1</span>, species_2<span class="op">=</span><span class="va">sp2</span><span class="op">)</span>,
         `depth (m)` <span class="op">=</span> <span class="va">depth</span><span class="op">)</span></code></pre></div>
<p>Given the ensembles, order statitics or quantiles seem like a natural choice to summarize uncertainty, so compute the median and upper and lower quartiles:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dtl</span> <span class="op">&lt;-</span> <span class="va">dtl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">depth</span>, <span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>density_50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">`density (m^-2)`</span><span class="op">)</span>,
         density_25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">`density (m^-2)`</span>, <span class="fl">.25</span><span class="op">)</span>,
         density_75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">`density (m^-2)`</span>, <span class="fl">.75</span><span class="op">)</span>
         <span class="op">)</span></code></pre></div>
<p>Putting these pieces together to visualize and describe the forecast and its uncertainty:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dtl</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span>, ymin<span class="op">=</span><span class="va">density_25</span>, ymax<span class="op">=</span><span class="va">density_75</span>, fill<span class="op">=</span><span class="va">name</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">`density (m^-2)`</span>, color<span class="op">=</span><span class="va">name</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">ensemble</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">#geom_smooth(aes(group=name), method='gam', formula= y ~ s(x, bs = "cs", k=30)) + </span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">density_50</span>, color<span class="op">=</span><span class="va">name</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">`depth (m)`</span> <span class="op">~</span> <span class="va">.</span>, labeller<span class="op">=</span><span class="va">label_both</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">'Median density'</span><span class="op">)</span>,
         fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">'25th-75th quantile density'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">'title'</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
       subtitle<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Forecast from"</span>, <span class="va">n_ensembles</span>, <span class="st">"ensembles (thin lines), with uncertainty from quantiles."</span><span class="op">)</span>,
       caption<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Demo visualization from EFIstandards package for an \nimaginary forecast at"</span>, <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"geographicDescription"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="visualization-example_files/figure-html/unnamed-chunk-2-1.png" alt="Forecast density of two interacting species at several depths with uncertainty." width="700"><p class="caption">
Forecast density of two interacting species at several depths with uncertainty.
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Carl Boettiger, Quinn Thomas, Michael Dietze, Alexey Shiklomanov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
