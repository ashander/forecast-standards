<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example metadata for a Lotka-Volterra population growth forecast • EFIstandards</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example metadata for a Lotka-Volterra population growth forecast">
<meta property="og:description" content="EFIstandards">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EFIstandards</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flare-metadata-example.html">Example metadata for a FLARE forecast</a>
    </li>
    <li>
      <a href="../articles/logistic-metadata-example.html">Example metadata for a Lotka-Volterra population growth forecast</a>
    </li>
    <li>
      <a href="../articles/visualization-example.html">Example of interacting with and visualizing EFI standard data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="logistic-metadata-example_files/header-attrs-2.5/header-attrs.js"></script><link href="logistic-metadata-example_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="logistic-metadata-example_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example metadata for a Lotka-Volterra population growth forecast</h1>
            
      
      
      <div class="hidden name"><code>logistic-metadata-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/EML/">EML</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://cirrus.ucsd.edu/~pierce/ncdf">ncdf4</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/emld/">emld</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span>
<span class="fu">emld</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/emld/reference/eml_version.html">eml_version</a></span><span class="op">(</span><span class="st">"eml-2.2.0"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "eml-2.2.0"</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></code></pre></div>
<p>A simple, example forecast of population growth of two interacting species</p>
<p>========================================================</p>
<div id="generating-the-forecast" class="section level1">
<h1 class="hasAnchor">
<a href="#generating-the-forecast" class="anchor"></a>Generating the forecast</h1>
<p>To illustrate the application of the forecast standard, we’ll consider the classic Lotka-Volterra population growth model. To keep this first example simple, we’ll only consider two species and two uncertainties - an additive process error, which converts this to a stochastic Lotka-Volterra, and an observation error. We’ll propagate uncertainty by running multiple ensembles. To illustrate the ability of the output format to accommodate spatial dimensions, we’ll run the model at multiple depths in a water column (e.g. lake or ocean) but those depths are not interacting – we know this isn’t realistic, but we want to keep things simple. Overall, this gives us the following <em>dimensions</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forecast_issue_time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2001-03-04"</span><span class="op">)</span>  <span class="co">## start date of our forecast</span>
<span class="va">n_time</span> <span class="op">&lt;-</span> <span class="fl">30</span>
<span class="va">times</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">forecast_issue_time</span>,by<span class="op">=</span><span class="st">"1 day"</span>,length<span class="op">=</span><span class="va">n_time</span><span class="op">)</span>

<span class="va">depths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">n_depths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">depths</span><span class="op">)</span>

<span class="va">n_ensembles</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">ensembles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">n_ensembles</span><span class="op">)</span>

<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species_1"</span>,<span class="st">"species_2"</span><span class="op">)</span>
<span class="va">n_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>

<span class="va">obs_dim</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co">## 1 = latent state</span>
             <span class="co">## 2 = latent state + observation error</span></code></pre></div>
<p>Next we’re going to assume fixed parameters and initial conditions, set up storage for our forecast output (which we see has 5 dimensions), and then forward simulate the populations</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## parameters for species_1 and species_2</span>
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">K</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>
<span class="va">alpha</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span>

<span class="co">## process error</span>
<span class="va">process_sd</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>

<span class="co">## observation error</span>
<span class="va">obs_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.2</span><span class="op">)</span>

<span class="co">## initial conditions</span>
<span class="va">n0</span> <span class="op">&lt;-</span>  <span class="fl">0.5</span>

<span class="co">## forecast output storage</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>,dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n_time</span>, <span class="va">n_depths</span>, <span class="va">n_ensembles</span>, <span class="va">obs_dim</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">## last dim is species</span>
<span class="va">n</span><span class="op">[</span><span class="fl">1</span>,,,,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">n0</span>

<span class="co">## forecast flag</span>
<span class="va">forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_time</span><span class="op">)</span> <span class="co">## this code indicated a hindcast</span>

<span class="co">## data assimilation flag</span>
<span class="va">data_assimilation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_time</span><span class="op">)</span>  <span class="co">## this code indicates a 'free-run' that didn't assimilate new data</span>

<span class="co">## forward simulation</span>
<span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">n_time</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">depth</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_depths</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">ens</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_ensembles</span><span class="op">)</span><span class="op">{</span>
      <span class="co">## predict latent state</span>
      <span class="va">n_curr</span> <span class="op">&lt;-</span> <span class="va">n</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span>,<span class="va">depth</span>,<span class="va">ens</span>,<span class="fl">1</span>,<span class="op">]</span> <span class="co">## current state</span>
      <span class="va">n</span><span class="op">[</span><span class="va">t</span>, <span class="va">depth</span>, <span class="va">ens</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">n_curr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> 
          <span class="va">r</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">n_curr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="va">n_curr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> 
          <span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">n_curr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">K</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">process_sd</span><span class="op">)</span>
      <span class="va">n</span><span class="op">[</span><span class="va">t</span>, <span class="va">depth</span>, <span class="va">ens</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">n_curr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> 
          <span class="va">r</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">n_curr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="va">n_curr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> 
          <span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">K</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">process_sd</span><span class="op">)</span>
      <span class="co">## predict observed values</span>
      <span class="va">n</span><span class="op">[</span><span class="va">t</span>,<span class="va">depth</span>,<span class="va">ens</span>,<span class="fl">2</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">2</span>,<span class="va">n</span><span class="op">[</span><span class="va">t</span>,<span class="va">depth</span>,<span class="va">ens</span>,<span class="fl">1</span>,<span class="op">]</span>,<span class="va">obs_sd</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Here’s a simple visualization of our ensemble forecast at one depth</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">n</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">"Population Density"</span>,type<span class="op">=</span><span class="st">'l'</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">##species</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">e</span> <span class="kw">in</span> <span class="va">ensembles</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">times</span>,<span class="va">n</span><span class="op">[</span>,<span class="fl">1</span>,<span class="va">e</span>,<span class="fl">1</span>,<span class="va">s</span><span class="op">]</span>,col<span class="op">=</span><span class="va">s</span><span class="op">)</span>                                  <span class="co">## latent</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">times</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n_time</span>,<span class="op">-</span><span class="fl">0.12</span>,<span class="fl">0.12</span><span class="op">)</span>,<span class="va">n</span><span class="op">[</span>,<span class="fl">1</span>,<span class="va">e</span>,<span class="fl">2</span>,<span class="va">s</span><span class="op">]</span>,col<span class="op">=</span><span class="va">s</span>,cex<span class="op">=</span><span class="fl">0.35</span><span class="op">)</span>  <span class="co">## pseudo-obs w/ jitter</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>,legend<span class="op">=</span><span class="va">species</span>,col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>,lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="logistic-metadata-example_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="saving-to-a-standardized-output-format" class="section level1">
<h1 class="hasAnchor">
<a href="#saving-to-a-standardized-output-format" class="anchor"></a>Saving to a standardized output format</h1>
<div id="standard-option-1-netcdf" class="section level2">
<h2 class="hasAnchor">
<a href="#standard-option-1-netcdf" class="anchor"></a>Standard Option 1: netCDF</h2>
<div id="forecast-identifiers" class="section level3">
<h3 class="hasAnchor">
<a href="#forecast-identifiers" class="anchor"></a>Forecast identifiers</h3>
<p>Because netCDF is a self-documenting format we’re going to start by defining some forecast identifiers (which we’ll also later use in the metadata)</p>
<p><code>forecast_project_id</code> identifies forecasts coming from a single project and is used to link forecasts different model versions. Examples might include a project Github repository or a team name.</p>
<p><code>forecast_model_id</code> is updated each time the forecast code is modified (e.g. model structure, model calibration, forecast workflow). Examples might be a DOI, version number, or Github hash. Results from a single forecast_model_id are considered comparable.</p>
<p><code>forecast_iteration_id</code> represents a unique ID for each forecast run. Examples might be a start time or database ID.</p>
<p>For example, if you have a forecast code base on GitHub and launch a forecast from that code that runs daily for 365 days, then there will be one forecast_project_id and 365 forecast_iteration_ids. A paper analyzing the forecasts would cite the forecast_project_id.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forecast_project_id</span> <span class="op">&lt;-</span> <span class="st">"LogisticDemo"</span>
<span class="va">forecast_model_id</span>   <span class="op">&lt;-</span> <span class="st">"v0.3"</span>
<span class="va">forecast_iteration_id</span> <span class="op">&lt;-</span> <span class="st">"20010304T060000"</span>   <span class="co"># ISO datetime should make a valid Forecast_id</span></code></pre></div>
</div>
<div id="netcdf-dimensions" class="section level3">
<h3 class="hasAnchor">
<a href="#netcdf-dimensions" class="anchor"></a>netcdf Dimensions</h3>
<p>Once we have our ID’s defined, we’re going to use <code>ncdim_def</code> to define the dimensions that our output variables will have</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Set dimensions</span>
<span class="va">timedim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span><span class="op">(</span><span class="st">"time"</span>,   <span class="co">## dimension name</span>
                     units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'days since'</span>,<span class="va">forecast_issue_time</span><span class="op">)</span>,
                               <span class="co">## size of timestep, with units and start date</span>
                     vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">times</span> <span class="op">-</span> <span class="va">forecast_issue_time</span><span class="op">)</span>,
                               <span class="co">## sequence of values that defines the dimension.</span>
                               <span class="co">## netCDF expresses time dimensions relative to a</span>
                               <span class="co">## specified start date, in this case forecast_issue_time</span>
                     longname <span class="op">=</span> <span class="st">'time'</span><span class="op">)</span>
                               <span class="co">## descriptive name</span>

<span class="va">depthdim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span><span class="op">(</span><span class="st">"depth"</span>, 
                      units <span class="op">=</span> <span class="st">"meters"</span>,
                      vals <span class="op">=</span> <span class="va">depths</span>, 
                      longname <span class="op">=</span> <span class="st">'Depth from surface'</span><span class="op">)</span> 

<span class="va">ensdim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span><span class="op">(</span><span class="st">"ensemble"</span>,             
                    units <span class="op">=</span> <span class="st">""</span>,
                    vals <span class="op">=</span> <span class="va">ensembles</span>,       
                    longname <span class="op">=</span> <span class="st">'ensemble member'</span><span class="op">)</span> 

<span class="va">obsdim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span><span class="op">(</span><span class="st">"obs_flag"</span>,
                    units <span class="op">=</span> <span class="st">""</span>,
                    vals <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">obs_dim</span>,
                    longname <span class="op">=</span> <span class="st">"observation error flag. 1 = latent state, 2 = w/ obs error"</span><span class="op">)</span>

<span class="co">## quick check that units are valid</span>
<span class="fu">udunits2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/udunits2/man/ud.is.parseable.html">ud.is.parseable</a></span><span class="op">(</span><span class="va">timedim</span><span class="op">$</span><span class="va">units</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">udunits2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/udunits2/man/ud.is.parseable.html">ud.is.parseable</a></span><span class="op">(</span><span class="va">depthdim</span><span class="op">$</span><span class="va">units</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">udunits2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/udunits2/man/ud.is.parseable.html">ud.is.parseable</a></span><span class="op">(</span><span class="va">ensdim</span><span class="op">$</span><span class="va">units</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">udunits2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/udunits2/man/ud.is.parseable.html">ud.is.parseable</a></span><span class="op">(</span><span class="va">obsdim</span><span class="op">$</span><span class="va">units</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="variable-names" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-names" class="anchor"></a>Variable names</h3>
<p>Once we’ve defined our dimensions, we can then define the metadata about our variables using <code>ncvar_def</code></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fillvalue</span> <span class="op">&lt;-</span> <span class="fl">1e32</span>  <span class="co">## missing data value</span>

<span class="co">#Define variables</span>
<span class="va">def_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">def_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span><span class="op">(</span>name <span class="op">=</span>  <span class="st">"species_1"</span>,
                           units <span class="op">=</span> <span class="st">"number of individuals"</span>,
                           dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">timedim</span>, <span class="va">depthdim</span>, <span class="va">ensdim</span>, <span class="va">obsdim</span><span class="op">)</span>,
                           missval <span class="op">=</span> <span class="va">fillvalue</span>,
                           longname <span class="op">=</span> <span class="st">'&lt;scientific name of species 1&gt;'</span>,
                           prec<span class="op">=</span><span class="st">"single"</span><span class="op">)</span>
<span class="va">def_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span><span class="op">(</span>name <span class="op">=</span>  <span class="st">"species_2"</span>,
                           units <span class="op">=</span> <span class="st">"number of individuals"</span>,
                           dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">timedim</span>, <span class="va">depthdim</span>, <span class="va">ensdim</span>, <span class="va">obsdim</span><span class="op">)</span>,
                           missval <span class="op">=</span> <span class="va">fillvalue</span>,
                           longname <span class="op">=</span> <span class="st">'&lt;scientific name of species 2&gt;'</span>,
                           prec<span class="op">=</span><span class="st">"single"</span><span class="op">)</span>
<span class="va">def_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span><span class="op">(</span>name <span class="op">=</span>  <span class="st">"forecast"</span>,
                           units <span class="op">=</span> <span class="st">"integer"</span>,
                           dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">timedim</span><span class="op">)</span>,
                           missval <span class="op">=</span> <span class="va">fillvalue</span>,
                           longname <span class="op">=</span> <span class="st">'EFI standard forecast code. 0 = hindcast'</span>,
                           prec<span class="op">=</span><span class="st">"single"</span><span class="op">)</span>
<span class="va">def_list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span><span class="op">(</span>name <span class="op">=</span>  <span class="st">"data_assimilation"</span>,
                           units <span class="op">=</span> <span class="st">"integer"</span>,
                           dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">timedim</span><span class="op">)</span>,
                           missval <span class="op">=</span> <span class="va">fillvalue</span>,
                           longname <span class="op">=</span> <span class="st">'EFI standard data assimilation code. 0 = no data'</span>,
                           prec<span class="op">=</span><span class="st">"single"</span><span class="op">)</span></code></pre></div>
</div>
<div id="creating-the-file" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-the-file" class="anchor"></a>Creating the file</h3>
<p>Finally, we’ll now create our netCDF file and add our outputs and global metadata to the file</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## file name</span>
<span class="va">ncfname</span> <span class="op">&lt;-</span> <span class="st">"logistic-forecast-ensemble-multi-variable-space-long.nc"</span>

<span class="co">## open your netCDF file</span>
<span class="va">ncout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_create.html">nc_create</a></span><span class="op">(</span><span class="va">ncfname</span>,<span class="va">def_list</span>,force_v4<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="co">## fill in our output data</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span><span class="op">(</span><span class="va">ncout</span>,<span class="va">def_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> , <span class="va">n</span><span class="op">[</span>, , , ,<span class="fl">1</span> <span class="op">]</span><span class="op">)</span>        <span class="co">## species 1</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span><span class="op">(</span><span class="va">ncout</span>,<span class="va">def_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> , <span class="va">n</span><span class="op">[</span>, , , ,<span class="fl">2</span> <span class="op">]</span><span class="op">)</span>        <span class="co">## species 2</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span><span class="op">(</span><span class="va">ncout</span>,<span class="va">def_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> , <span class="va">forecast</span><span class="op">)</span> <span class="co">## forecast flag</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span><span class="op">(</span><span class="va">ncout</span>,<span class="va">def_list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> , <span class="va">data_assimilation</span><span class="op">)</span> <span class="co">## data_assimilation flag</span>

<span class="co">## Global attributes (metadata)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncatt_put.html">ncatt_put</a></span><span class="op">(</span><span class="va">ncout</span>,<span class="fl">0</span>,<span class="st">"forecast_project_id"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">forecast_project_id</span><span class="op">)</span>, 
          prec <span class="op">=</span>  <span class="st">"text"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncatt_put.html">ncatt_put</a></span><span class="op">(</span><span class="va">ncout</span>,<span class="fl">0</span>,<span class="st">"forecast_model_id"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">forecast_model_id</span><span class="op">)</span>, 
          prec <span class="op">=</span>  <span class="st">"text"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncatt_put.html">ncatt_put</a></span><span class="op">(</span><span class="va">ncout</span>,<span class="fl">0</span>,<span class="st">"forecast_iteration_id"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">forecast_iteration_id</span><span class="op">)</span>, 
          prec <span class="op">=</span>  <span class="st">"text"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_close.html">nc_close</a></span><span class="op">(</span><span class="va">ncout</span><span class="op">)</span>   <span class="co">## make sure to close the file</span></code></pre></div>
</div>
</div>
</div>
<div id="standard-option-2-ensemble-csv" class="section level1">
<h1 class="hasAnchor">
<a href="#standard-option-2-ensemble-csv" class="anchor"></a>Standard Option 2: ensemble CSV</h1>
<p>Convert to a flat file format (CSV) with one column for each variable and all ensemble members saved</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## wrangle data into a tidy format</span>
<span class="va">df_combined</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">n</span>,varnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>,<span class="st">"depth"</span>,<span class="st">"ensemble"</span>,<span class="st">"obs_flag"</span>,<span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,names_from <span class="op">=</span> <span class="st">"species"</span>,names_prefix <span class="op">=</span> <span class="st">"species_"</span>,values_from <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">times</span><span class="op">[</span><span class="va">time</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>depth <span class="op">=</span> <span class="va">depths</span><span class="op">[</span><span class="va">depth</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">times</span>,forecast<span class="op">=</span><span class="va">forecast</span>,data_assimilation <span class="op">=</span> <span class="va">data_assimilation</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: `data_frame()` is deprecated as of tibble 1.1.0.
## Please use `tibble()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Joining, by = "time"</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_combined</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   time       depth ensemble obs_flag species_1 species_2 forecast
##   &lt;date&gt;     &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 2001-03-04     1        1        1     0.5        0.5         0
## 2 2001-03-05     1        1        1     0.984      1.95        0
## 3 2001-03-06     1        1        1     1.82       7.16        0
## 4 2001-03-07     1        1        1     3.04      20.8         0
## 5 2001-03-08     1        1        1     3.88      17.8         0
## 6 2001-03-09     1        1        1     4.87      23.2         0
## # ... with 1 more variable: data_assimilation &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">df_combined</span>, 
          file <span class="op">=</span> <span class="st">"logistic-forecast-ensemble-multi-variable-multi-depth.csv"</span><span class="op">)</span></code></pre></div>
</div>
<div id="standard-option-3-summary-csv" class="section level1">
<h1 class="hasAnchor">
<a href="#standard-option-3-summary-csv" class="anchor"></a>Standard Option 3: summary CSV</h1>
<p>Convert to a flat file format (CSV) with forecast distribution summaries saved</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## calculate summary statistics across ensemble members and output variables</span>
<span class="va">dfs</span> <span class="op">&lt;-</span> <span class="va">df_combined</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,names_to<span class="op">=</span><span class="st">"species"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">## make species a column</span>
                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">depth</span>,<span class="va">obs_flag</span>,<span class="va">species</span>,<span class="va">forecast</span>,<span class="va">data_assimilation</span><span class="op">)</span> <span class="op">%&gt;%</span>
                   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,
                             sd   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,
                             Conf_interv_02.5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">0.025</span><span class="op">)</span>,
                             Conf_interv_97.5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
                   <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">10</span>,names_to<span class="op">=</span><span class="st">"statistic"</span><span class="op">)</span>  <span class="op">%&gt;%</span> <span class="co">## make statistic column</span>
                   <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from<span class="op">=</span><span class="va">species</span>,values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="co">## go back to species wide</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by 'time', 'depth', 'obs_flag', 'species', 'forecast' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## recode statistics</span>
<span class="va">dfs</span><span class="op">$</span><span class="va">statistic</span><span class="op">[</span><span class="va">dfs</span><span class="op">$</span><span class="va">obs_flag</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dfs</span><span class="op">$</span><span class="va">statistic</span> <span class="op">==</span> <span class="st">"sd"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"se"</span>
<span class="va">dfs</span><span class="op">$</span><span class="va">statistic</span><span class="op">[</span><span class="va">dfs</span><span class="op">$</span><span class="va">obs_flag</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">dfs</span><span class="op">$</span><span class="va">statistic</span> <span class="op">==</span> <span class="st">"Conf_interv_02.5"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Pred_interv_0.25"</span>
<span class="va">dfs</span><span class="op">$</span><span class="va">statistic</span><span class="op">[</span><span class="va">dfs</span><span class="op">$</span><span class="va">obs_flag</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">dfs</span><span class="op">$</span><span class="va">statistic</span> <span class="op">==</span> <span class="st">"Conf_interv_02.5"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Pred_interv_0.25"</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dfs</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
## # Groups:   time, depth, obs_flag, forecast [2]
##   time       depth obs_flag forecast data_assimilati~ statistic species_1
##   &lt;date&gt;     &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;
## 1 2001-03-04     1        1        0                0 mean            0.5
## 2 2001-03-04     1        1        0                0 se              0  
## 3 2001-03-04     1        1        0                0 Conf_int~       0.5
## 4 2001-03-04     1        1        0                0 Conf_int~       0.5
## 5 2001-03-04     1        2        0                0 mean            0.5
## 6 2001-03-04     1        2        0                0 sd              0  
## # ... with 1 more variable: species_2 &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">dfs</span>, file <span class="op">=</span> <span class="st">"logistic-forecast-summary-multi-variable-multi-depth.csv"</span><span class="op">)</span></code></pre></div>
</div>
<div id="standardized-metadata" class="section level1">
<h1 class="hasAnchor">
<a href="#standardized-metadata" class="anchor"></a>Standardized Metadata</h1>
<div id="forecast-output-entity-datatable" class="section level3">
<h3 class="hasAnchor">
<a href="#forecast-output-entity-datatable" class="anchor"></a>Forecast output entity: dataTable</h3>
<p>Let’s begin by documenting the metadata of the forecast output data table itself, which we’ll do using EML’s <code>dataTable</code> entity. In this example we’ll assume we’re working with format 2 (ensemble CSV), though most of the metadata would be identical for all three formats.</p>
<p>To start, the <code>attributes</code> table stores the basic metadata about the variable names and units.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## define variable names, units, etc</span>
<span class="co">## in practice, this might be kept in a spreadsheet</span>
<span class="va">attributes</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
 <span class="op">~</span><span class="va">attributeName</span>,     <span class="op">~</span><span class="va">attributeDefinition</span>,                          <span class="op">~</span><span class="va">unit</span>,                  <span class="op">~</span><span class="va">formatString</span>, <span class="op">~</span><span class="va">numberType</span>, <span class="op">~</span><span class="va">definition</span>,
 <span class="st">"time"</span>,              <span class="st">"[dimension]{time}"</span>,                          <span class="st">"year"</span>,                 <span class="st">"YYYY-MM-DD"</span>,  <span class="st">"numberType"</span>, <span class="cn">NA</span>,
 <span class="st">"depth"</span>,             <span class="st">"[dimension]{depth in reservior}"</span>,            <span class="st">"meter"</span>,                 <span class="cn">NA</span>,           <span class="st">"real"</span>,       <span class="cn">NA</span>,
 <span class="st">"ensemble"</span>,          <span class="st">"[dimension]{index of ensemble member}"</span>,      <span class="st">"dimensionless"</span>,         <span class="cn">NA</span>,           <span class="st">"integer"</span>,    <span class="cn">NA</span>,
 <span class="st">"obs_flag"</span>,          <span class="st">"[dimension]{observation error}"</span>,             <span class="st">"dimensionless"</span>,         <span class="cn">NA</span>,           <span class="st">"integer"</span>,    <span class="cn">NA</span>,
 <span class="st">"species_1"</span>,         <span class="st">"[variable]{Pop. density of species 1}"</span>,      <span class="st">"numberPerMeterSquared"</span>, <span class="cn">NA</span>,           <span class="st">"real"</span>,       <span class="cn">NA</span>,
 <span class="st">"species_2"</span>,         <span class="st">"[variable]{Pop. density of species 2}"</span>,      <span class="st">"numberPerMeterSquared"</span>, <span class="cn">NA</span>,           <span class="st">"real"</span>,       <span class="cn">NA</span>,
 <span class="st">"forecast"</span>,          <span class="st">"[flag]{whether time step assimilated data}"</span>, <span class="st">"dimensionless"</span>,         <span class="cn">NA</span>,           <span class="st">"integer"</span>,    <span class="cn">NA</span>,
 <span class="st">"data_assimilation"</span>, <span class="st">"[flag]{whether time step assimilated data}"</span>, <span class="st">"dimensionless"</span>,         <span class="cn">NA</span>,           <span class="st">"integer"</span>,    <span class="cn">NA</span>
<span class="op">)</span> 
<span class="co">## note: EML uses a different unit standard than UDUNITS. For now use EML. EFI needs to provide a custom unitList.</span>
<span class="va">attributes</span></code></pre></div>
<pre><code>## # A tibble: 8 x 6
##   attributeName  attributeDefinition  unit    formatString numberType definition
##   &lt;chr&gt;          &lt;chr&gt;                &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;      &lt;lgl&gt;     
## 1 time           [dimension]{time}    year    YYYY-MM-DD   numberType NA        
## 2 depth          [dimension]{depth i~ meter   &lt;NA&gt;         real       NA        
## 3 ensemble       [dimension]{index o~ dimens~ &lt;NA&gt;         integer    NA        
## 4 obs_flag       [dimension]{observa~ dimens~ &lt;NA&gt;         integer    NA        
## 5 species_1      [variable]{Pop. den~ number~ &lt;NA&gt;         real       NA        
## 6 species_2      [variable]{Pop. den~ number~ &lt;NA&gt;         real       NA        
## 7 forecast       [flag]{whether time~ dimens~ &lt;NA&gt;         integer    NA        
## 8 data_assimila~ [flag]{whether time~ dimens~ &lt;NA&gt;         integer    NA</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">attrList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/set_attributes.html">set_attributes</a></span><span class="op">(</span><span class="va">attributes</span>, 
                           col_classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"numeric"</span>, <span class="st">"numeric"</span>,<span class="st">"numeric"</span>, 
                                           <span class="st">"numeric"</span>,<span class="st">"numeric"</span>, <span class="st">"numeric"</span>,<span class="st">"numeric"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that the EFI standard extends the EML <code>attibuteDefinition</code> to include a [variable_type] and {variable_definition}. The options for [variable_type] include: * dimension * variable = output variable * diagnostic = variable output purely for diagnostic purposes * observation = data that is or could be compared to an output_variable * obs_error * flag * initial_condition * driver * parameter * random_effect * process_error</p>
<p>We then link the attribute information with the info about a particular file</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## sets metadata about the file itself (name, file type, size, MD5, etc)</span>
<span class="va">physical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/set_physical.html">set_physical</a></span><span class="op">(</span><span class="st">"logistic-forecast-ensemble-multi-variable-multi-depth.csv"</span>,
                         recordDelimiter<span class="op">=</span><span class="st">'\n'</span><span class="op">)</span></code></pre></div>
<pre><code>## Automatically calculated file size using file.size("logistic-forecast-ensemble-multi-variable-multi-depth.csv")</code></pre>
<pre><code>## Automatically calculated authentication size using digest::digest("logistic-forecast-ensemble-multi-variable-multi-depth.csv", algo = "md5", file = TRUE)</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set metadata for the file as a whole</span>
<span class="va">dataTable</span> <span class="op">&lt;-</span> <span class="va">eml</span><span class="op">$</span><span class="fu">dataTable</span><span class="op">(</span>
                 entityName <span class="op">=</span> <span class="st">"forecast"</span>,  <span class="co">## this is a standard name to allow us to distinguish this entity from </span>
                 entityDescription <span class="op">=</span> <span class="st">"Forecast of population size using a depth specific model"</span>,
                 physical <span class="op">=</span> <span class="va">physical</span>,
                 attributeList <span class="op">=</span> <span class="va">attrList</span><span class="op">)</span></code></pre></div>
<p>Here <code>entityName = "forecast"</code> is a standard name within the EFI standard to allow us to distinguish this entity from metadata about parameters, drivers, etc.</p>
<p>There’s a lot more optional terminology that could be exploited here – for instance, the specification lets us define different missing value codes (and explanations) for each column, and allows us to indicate <code>precision</code>, <code>minimum</code> and <code>maximum</code>.</p>
<p>Note that <code>physical</code> type can document almost any formats as well, including NetCDF etc. A NetCDF file would still document the variables measured in much the same way regardless of the underlying representation.</p>
</div>
<div id="provenance" class="section level3">
<h3 class="hasAnchor">
<a href="#provenance" class="anchor"></a>Provenance</h3>
<p>Now that we’ve documented the actual data.frame itself, we can add additional metadata to the record describing our forecast, which is essential for citing, discovering, and interpreting the result. We start with some authorship information.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>individualName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>givenName <span class="op">=</span> <span class="st">"Quinn"</span>, 
                                 surName <span class="op">=</span> <span class="st">"Thomas"</span><span class="op">)</span>,
           electronicMailAddress <span class="op">=</span> <span class="st">"rqthomas@vt.edu"</span>,
           id <span class="op">=</span> <span class="st">"https://orcid.org/0000-0003-1282-7825"</span><span class="op">)</span></code></pre></div>
</div>
<div id="coverage" class="section level3">
<h3 class="hasAnchor">
<a href="#coverage" class="anchor"></a>Coverage</h3>
<p>Set Taxonomic, Temporal, and Geographic Coverage. (Look, apparently we’re modeling population densities of <em>Gloeotrichia echinulata</em> and <em>Anabaena circinalis</em> cyanobacterium in Lake Sunapee, NH, USA)</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">Genus</span>,      <span class="op">~</span><span class="va">Species</span>,
<span class="st">"Gloeotrichia"</span>, <span class="st">"echinulata"</span>,
<span class="st">"Anabaena"</span>,     <span class="st">"circinalis"</span><span class="op">)</span>
<span class="va">coverage</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://docs.ropensci.org/EML/reference/set_coverage.html">set_coverage</a></span><span class="op">(</span>begin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, 
               end <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>,
               sci_names <span class="op">=</span> <span class="va">taxa</span>,
               geographicDescription <span class="op">=</span> <span class="st">"Lake Sunapee, NH, USA "</span>,
               west <span class="op">=</span> <span class="op">-</span><span class="fl">72.15</span>, east <span class="op">=</span> <span class="op">-</span><span class="fl">72.05</span>, 
               north <span class="op">=</span> <span class="fl">43.48</span>, south <span class="op">=</span> <span class="fl">43.36</span><span class="op">)</span></code></pre></div>
</div>
<div id="keywords" class="section level3">
<h3 class="hasAnchor">
<a href="#keywords" class="anchor"></a>Keywords</h3>
<p>Set key words. We will need to develop a EFI controlled vocabulary</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">keywordSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        keywordThesaurus <span class="op">=</span> <span class="st">"EFI controlled vocabulary"</span>,
        keyword <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"forecast"</span>,
                    <span class="st">"population"</span>,
                    <span class="st">"timeseries"</span><span class="op">)</span>
    <span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="abstract" class="section level3">
<h3 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h3>
<p>Our dataset needs an abstract describing what this is all about.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">abstract_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"abstract.md"</span>, package<span class="op">=</span><span class="st">"EFIstandards"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h3>
<p>Next, we’ll combine these various bits to document the output dataset as a whole</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset</span> <span class="op">=</span> <span class="va">eml</span><span class="op">$</span><span class="fu">dataset</span><span class="op">(</span>
               title <span class="op">=</span> <span class="st">"A very simple Lotka-Volterra forecast"</span>,
               creator <span class="op">=</span> <span class="va">me</span>,
               contact <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>references<span class="op">=</span><span class="st">"https://orcid.org/0000-0003-1282-7825"</span><span class="op">)</span>,
               pubDate <span class="op">=</span> <span class="va">forecast_issue_time</span>,
               intellectualRights <span class="op">=</span> <span class="st">"http://www.lternet.edu/data/netpolicy.html."</span>,
               abstract <span class="op">=</span>  <span class="st">"An illustration of how we might use EML metadata to describe an ecological forecast"</span>,
               dataTable <span class="op">=</span> <span class="va">dataTable</span>,
               keywordSet <span class="op">=</span> <span class="va">keywordSet</span>,
               coverage <span class="op">=</span> <span class="va">coverage</span>
               <span class="op">)</span></code></pre></div>
</div>
<div id="forecast-specific-additionalmetadata" class="section level2">
<h2 class="hasAnchor">
<a href="#forecast-specific-additionalmetadata" class="anchor"></a>Forecast-specific additionalMetadata</h2>
<p>The EFI standard is using EML’s <code>additionalMetadata</code> capacity. Section 2.1 of the EFI standard describes both the basic elements (2.1.1) and the info about model structure and uncertainty (2.1.2).</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">additionalMetadata</span> <span class="op">&lt;-</span> <span class="va">eml</span><span class="op">$</span><span class="fu">additionalMetadata</span><span class="op">(</span>
  metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    forecast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
<span class="co">## Basic elements</span>
      timestep <span class="op">=</span> <span class="st">"1 day"</span>, <span class="co">## should be udunits parsable; already in coverage -&gt; temporalCoverage?</span>
      forecast_horizon <span class="op">=</span> <span class="st">"30 days"</span>,
      forecast_issue_time <span class="op">=</span> <span class="va">forecast_issue_time</span>,
      forecast_iteration_id <span class="op">=</span> <span class="va">forecast_iteration_id</span>,
      forecast_project_id <span class="op">=</span> <span class="va">forecast_project_id</span>,
      metadata_standard_version <span class="op">=</span> <span class="st">"0.3"</span>,
      model_description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        forecast_model_id <span class="op">=</span> <span class="va">forecast_model_id</span>,
        name <span class="op">=</span> <span class="st">"discrete Lotka–Volterra model"</span>,
        type <span class="op">=</span> <span class="st">"process-based"</span>,
        repository <span class="op">=</span> <span class="st">"https://github.com/eco4cast/EFIstandards/blob/master/vignettes/logistic-metadata-example.Rmd"</span>
      <span class="op">)</span>,
<span class="co">## MODEL STRUCTURE &amp; UNCERTAINTY CLASSES</span>
      initial_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        <span class="co"># Possible values: absent, present, data_driven, propagates, assimilates</span>
        status <span class="op">=</span> <span class="st">"present"</span>,
        <span class="co"># Number of parameters / dimensionality</span>
        complexity <span class="op">=</span> <span class="fl">2</span>  <span class="co">## [species 1, species 2] per depth</span>
      <span class="op">)</span>,
      drivers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        status <span class="op">=</span> <span class="st">"absent"</span>
      <span class="op">)</span>,
      parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        status <span class="op">=</span> <span class="st">"present"</span>,
        complexity <span class="op">=</span> <span class="fl">6</span>  <span class="co">## [r, K, alpha] x 2 spp</span>
      <span class="op">)</span>,
      random_effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        status <span class="op">=</span> <span class="st">"absent"</span>
      <span class="op">)</span>,
      process_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        status <span class="op">=</span> <span class="st">"propagates"</span>,
        propagation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
          type <span class="op">=</span> <span class="st">"ensemble"</span>, <span class="co"># ensemble vs analytic</span>
          size <span class="op">=</span> <span class="fl">10</span>          <span class="co"># required if ensemble</span>
        <span class="op">)</span>,
        complexity <span class="op">=</span> <span class="fl">2</span>,   
        covariance <span class="op">=</span> <span class="cn">FALSE</span>
      <span class="op">)</span>,
      obs_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        status <span class="op">=</span> <span class="st">"present"</span>,
        complexity <span class="op">=</span> <span class="fl">2</span>,   
        covariance <span class="op">=</span> <span class="cn">FALSE</span>
      <span class="op">)</span>
    <span class="op">)</span> <span class="co"># forecast</span>
  <span class="op">)</span> <span class="co"># metadata</span>
<span class="op">)</span> <span class="co"># eml$additionalMetadata</span></code></pre></div>
<p>Within the <code>additionalMetadata</code>, we anticipate the model structure info will be the most challenging to document. All six model structural elements / uncertainty classes need to be documented, even if just to record that a specific element is absent in the model. The six classes are:</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th>Class</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>initial_conditions</td>
<td>Uncertainty in the initialization of state variables (Y)</td>
</tr>
<tr class="even">
<td>drivers</td>
<td>Uncertainty in model drivers, covariates, and exogenous scenarios (X)</td>
</tr>
<tr class="odd">
<td>parameters</td>
<td>Uncertainty in model parameters (<span class="math inline">\(\theta\)</span>)</td>
</tr>
<tr class="even">
<td>random_effects</td>
<td>Unexplained variability and heterogeneity in model parameters (<span class="math inline">\(\alpha\)</span>)</td>
</tr>
<tr class="odd">
<td>obs_error</td>
<td>Uncertainty in the observations of the output variables (g)</td>
</tr>
<tr class="even">
<td>process_error</td>
<td>Dynamic uncertainty in the process model (<span class="math inline">\(\epsilon\)</span>)</td>
</tr>
</tbody>
</table>
<p>Each class has a very similar structure and the only required element in each is <code>status</code> which can take on the following valid values</p>
<table class="table">
<colgroup>
<col width="15%">
<col width="84%">
</colgroup>
<thead><tr class="header">
<th>status</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>absent</td>
<td>This model does not contain this concept (e.g. a linear regression model doesn’t have initial conditions, random effects, or process_error).</td>
</tr>
<tr class="even">
<td>present</td>
<td>The model contains this concept (e.g. the model has parameters), but the values used are not derived from data and no uncertainty is represented</td>
</tr>
<tr class="odd">
<td>data_driven</td>
<td>The model contains this concept and the inputs are data driven but uncertainty in this input is not explicitly propagated into predictions.</td>
</tr>
<tr class="even">
<td>propagates</td>
<td>The model propagates uncertainty about this term into forecasts</td>
</tr>
<tr class="odd">
<td>assimilates</td>
<td>The model iteratively updates this term through data assimilation.</td>
</tr>
</tbody>
</table>
<p>Except for ‘absent’ this list is ordinal (e.g. data_driven implies present)</p>
<p>Next, the <code>&lt;complexity&gt;</code> tag is recommended, but not required, and should list the size/dimension of each status/uncertainty class at a single location (per dimensions defined above). For example, the logistic model has two initial conditions (n[1], n[2]), six parameters (r, K, and alpha for each species), and both process and observation error on the two state variables. <code>absent</code> statuses don’t need to be documented as 0 as this is implied.</p>
<p>The <code>&lt;covariance&gt;</code> tag states whether the errors/uncertainties within an uncertainty class are being treated as independent or not.</p>
<p>Finally, the <code>&lt;propagation&gt;</code> and <code>&lt;assimilation&gt;</code> tags provide additional information about the methods used (see EFI standard doc).</p>
</div>
<div id="assembling-and-validating-the-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#assembling-and-validating-the-metadata" class="anchor"></a>Assembling and validating the metadata</h2>
<p>All we need now is to combine the dataset metadata with the forecast additionalMetadata</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_eml</span> <span class="op">&lt;-</span> <span class="va">eml</span><span class="op">$</span><span class="fu">eml</span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">dataset</span>,
           additionalMetadata <span class="op">=</span> <span class="va">additionalMetadata</span>,
           packageId <span class="op">=</span> <span class="va">forecast_iteration_id</span> , 
           system <span class="op">=</span> <span class="st">"datetime"</span>  <span class="co">## system used to generate packageId</span>
           <span class="op">)</span></code></pre></div>
<p>Once we have finished building our EML metadata, we can confirm it is valid.<br>
This will catch any missing elements. (Recall that what is ‘required’ depends on what you include – for example, you don’t have to document a <code>dataTable</code> at all, but if you do, you have to document the “physical” file format it is in<br>
(e.g. <code>csv</code>) and the attributes and units it uses!)</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## check base EML</span>
<span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_validate.html">eml_validate</a></span><span class="op">(</span><span class="va">my_eml</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE
## attr(,"errors")
## character(0)</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## check that the EML is also a valid EFI forecast</span>
<span class="fu">EFIstandards</span><span class="fu">::</span><span class="fu"><a href="../reference/forecast_validator.html">forecast_validator</a></span><span class="op">(</span><span class="va">my_eml</span><span class="op">)</span></code></pre></div>
<pre><code>## * Checking Validity of EML file...</code></pre>
<pre><code>## √ EML is valid</code></pre>
<pre><code>## √ additionalMetadata found</code></pre>
<pre><code>## √ metadata found</code></pre>
<pre><code>## √ forecast found</code></pre>
<pre><code>## √ timestep parsable</code></pre>
<pre><code>## √ forecast_horizon parsable</code></pre>
<pre><code>## √ forecast_issue_time found</code></pre>
<pre><code>## √ forecast_iteration_id found</code></pre>
<pre><code>## √ forecast_project_id found</code></pre>
<pre><code>## √ metadata_standard_version found</code></pre>
<pre><code>## √ model_description found</code></pre>
<pre><code>## √ forecast_model_id found</code></pre>
<pre><code>## √ name found</code></pre>
<pre><code>## √ type found</code></pre>
<pre><code>## √ repository found</code></pre>
<pre><code>## √ initial_conditions found</code></pre>
<pre><code>## √ status found</code></pre>
<pre><code>## √ initial_conditions status/uncertainty class valid: present</code></pre>
<pre><code>## √ complexity valid</code></pre>
<pre><code>## √ parameters found</code></pre>
<pre><code>## √ status found</code></pre>
<pre><code>## √ parameters status/uncertainty class valid: present</code></pre>
<pre><code>## √ complexity valid</code></pre>
<pre><code>## √ drivers found</code></pre>
<pre><code>## √ status found</code></pre>
<pre><code>## √ drivers status/uncertainty class valid: absent</code></pre>
<pre><code>## √ random_effects found</code></pre>
<pre><code>## √ status found</code></pre>
<pre><code>## √ random_effects status/uncertainty class valid: absent</code></pre>
<pre><code>## √ process_error found</code></pre>
<pre><code>## √ status found</code></pre>
<pre><code>## √ process_error status/uncertainty class valid: propagates</code></pre>
<pre><code>## √ complexity valid</code></pre>
<pre><code>## √ type found</code></pre>
<pre><code>## √ process_error propagation type valid: ensemble</code></pre>
<pre><code>## √ size valid</code></pre>
<pre><code>## √ obs_error found</code></pre>
<pre><code>## √ status found</code></pre>
<pre><code>## √ obs_error status/uncertainty class valid: present</code></pre>
<pre><code>## √ complexity valid</code></pre>
<pre><code>## [1] TRUE
## attr(,"errors")
## character(0)</code></pre>
<p>We are now ready to write out a valid EML document:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/write_eml.html">write_eml</a></span><span class="op">(</span><span class="va">my_eml</span>, <span class="st">"forecast-eml.xml"</span><span class="op">)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>At this point, we could easily upload this metadata along with the data itself to a repository (e.g. DataONE) manually or via an API.</p>
<p>We can also generate a JSON-LD version of EML:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">emld</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/emld/reference/as_json.html">as_json</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/emld/reference/as_emld.html">as_emld</a></span><span class="op">(</span><span class="st">"forecast-eml.xml"</span><span class="op">)</span>, file <span class="op">=</span> <span class="st">"forecast-eml.json"</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Carl Boettiger, Quinn Thomas, Michael Dietze, Alexey Shiklomanov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
