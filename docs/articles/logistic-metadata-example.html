<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forecasting Metadata • EFIstandards</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Forecasting Metadata">
<meta property="og:description" content="EFIstandards">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EFIstandards</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flare-metadata-example.html">Forecasting Metadata</a>
    </li>
    <li>
      <a href="../articles/logistic-metadata-example.html">Forecasting Metadata</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Forecasting Metadata</h1>
            
      
      
      <div class="hidden name"><code>logistic-metadata-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">EML</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">uuid</span>)
<span class="kw pkg">emld</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/emld/reference/eml_version.html">eml_version</a></span>(<span class="st">"eml-2.2.0"</span>)</pre></body></html></div>
<pre><code>## [1] "eml-2.2.0"</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">42</span>)</pre></body></html></div>
<p>A simple, example forecast of population Growth of two interacting species</p>
<p>========================================================</p>
<p>First, set the forecast identifiers</p>
<p>ForecastProject_id represents the launch of an automated, iterative forecast. It is created each time a human modifies the forecast code. It can be a DOI because this is the level that we envision citations occuring.</p>
<p>Forecast_id represents each forecast cycle within a ForecastProject_id</p>
<p>For example, if you have a forecast code base on GitHub and launch a forecast from that code that runs daily for 365 days, then there will be one ForecastProject_id and 365 Forecast_ids. A paper analyzing the forecasts would cite the ForecastProject_id.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">forecast_issue_time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2001-03-04"</span>)
<span class="co">#Forecast_id &lt;- uuid::UUIDgenerate() #ID that applies to the specific forecast</span>
<span class="no">Forecast_id</span> <span class="kw">&lt;-</span> <span class="st">"20010304T060000"</span>     <span class="co"># ISO datetime should make a valid Forecast_id</span>
<span class="no">ForecastProject_id</span> <span class="kw">&lt;-</span> <span class="fl">30405043</span> <span class="co">#Some ID that applies to a set of forecasts</span></pre></body></html></div>
<div id="generating-the-forecast" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-the-forecast" class="anchor"></a>Generating the forecast</h2>
<p>Multi-species growth for multiple depths with process uncertainty</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">NT</span> <span class="kw">&lt;-</span> <span class="fl">30</span>
<span class="no">n_ensembles</span> <span class="kw">&lt;-</span> <span class="fl">10</span>
<span class="no">n_depths</span> <span class="kw">&lt;-</span> <span class="fl">3</span>
<span class="no">depths</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>)

<span class="no">r</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">3</span>)
<span class="no">K</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>, <span class="fl">20</span>)
<span class="no">alpha</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>)
<span class="no">n0</span> <span class="kw">&lt;-</span>  <span class="fl">0.5</span>

<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="fl">NA</span>,<span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="no">NT</span>, <span class="no">n_depths</span>, <span class="no">n_ensembles</span>))
<span class="no">n</span>[,<span class="fl">1</span>,,] <span class="kw">&lt;-</span> <span class="no">n0</span>

<span class="no">process_sd</span> <span class="kw">&lt;-</span> <span class="fl">0.01</span>

<span class="no">data_assimilation</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="no">NT</span>)

<span class="kw">for</span>(<span class="no">t</span> <span class="kw">in</span> <span class="fl">2</span>:<span class="no">NT</span>){
  <span class="no">data_assimilation</span>[<span class="no">t</span>] <span class="kw">&lt;-</span> <span class="fl">0</span>
  <span class="kw">for</span>(<span class="no">depth</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_depths</span>){
    <span class="kw">for</span>(<span class="no">ens</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_ensembles</span>){
      <span class="no">n</span>[<span class="fl">1</span>, <span class="no">t</span>, <span class="no">depth</span>, <span class="no">ens</span>] <span class="kw">&lt;-</span>  <span class="no">n</span>[<span class="fl">1</span>, <span class="no">t</span>-<span class="fl">1</span>, <span class="no">depth</span>, <span class="no">ens</span>] +
          <span class="no">r</span>[<span class="fl">1</span>]*<span class="no">n</span>[<span class="fl">1</span>, <span class="no">t</span>-<span class="fl">1</span>,<span class="no">depth</span>,<span class="no">ens</span>]*(<span class="fl">1</span>-((<span class="no">n</span>[<span class="fl">1</span>, <span class="no">t</span>-<span class="fl">1</span>, <span class="no">depth</span>, <span class="no">ens</span>] +
          <span class="no">alpha</span>[<span class="fl">1</span>]*<span class="no">n</span>[<span class="fl">2</span>, <span class="no">t</span>-<span class="fl">1</span>, <span class="no">depth</span>, <span class="no">ens</span>])/<span class="no">K</span>[<span class="fl">1</span>])) + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="no">process_sd</span>)
      <span class="no">n</span>[<span class="fl">2</span>, <span class="no">t</span>, <span class="no">depth</span>, <span class="no">ens</span>] <span class="kw">&lt;-</span>  <span class="no">n</span>[<span class="fl">2</span>, <span class="no">t</span>-<span class="fl">1</span>, <span class="no">depth</span>, <span class="no">ens</span>] +
          <span class="no">r</span>[<span class="fl">2</span>]*<span class="no">n</span>[<span class="fl">2</span>, <span class="no">t</span>-<span class="fl">1</span>, <span class="no">depth</span>, <span class="no">ens</span>]*(<span class="fl">1</span>-((<span class="no">n</span>[<span class="fl">2</span>, <span class="no">t</span>-<span class="fl">1</span>, <span class="no">depth</span>, <span class="no">ens</span>] +
          <span class="no">alpha</span>[<span class="fl">2</span>]*<span class="no">n</span>[<span class="fl">1</span>, <span class="no">t</span>-<span class="fl">1</span>, <span class="no">depth</span>, <span class="no">ens</span>])/<span class="no">K</span>[<span class="fl">2</span>])) + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="no">process_sd</span>)
    }
  }
}</pre></body></html></div>
</div>
<div id="saving-to-a-standardized-output-format" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-to-a-standardized-output-format" class="anchor"></a>Saving to a standardized output format</h2>
</div>
<div id="standard-option-1-netcdf" class="section level1">
<h1 class="hasAnchor">
<a href="#standard-option-1-netcdf" class="anchor"></a>Standard Option 1: netCDF</h1>
<p>Convert to a netcdf format</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ncdf4</span>)

<span class="no">ncfname</span> <span class="kw">&lt;-</span> <span class="st">"logistic-forecast-ensemble-multi-variable-space-long.nc"</span>

<span class="no">time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">2000</span> + <span class="fl">1</span>:<span class="no">NT</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"%Y"</span>)

<span class="no">data_assimilation</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">time</span>))

<span class="co">#Set dimensions</span>
<span class="no">ens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="no">n_ensembles</span>,<span class="fl">1</span>))
<span class="no">depths</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>))
<span class="no">timestep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="no">NT</span>, <span class="fl">1</span>))

<span class="no">ensdim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span>(<span class="st">"ens"</span>,
                    <span class="kw">units</span> <span class="kw">=</span> <span class="st">""</span>,
                    <span class="kw">vals</span> <span class="kw">=</span> <span class="no">ens</span>,
                    <span class="kw">longname</span> <span class="kw">=</span> <span class="st">'ensemble member'</span>)
<span class="no">depthdim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span>(<span class="st">"depth"</span>,
                      <span class="kw">units</span> <span class="kw">=</span> <span class="st">"meters"</span>,
                      <span class="kw">vals</span> <span class="kw">=</span> <span class="no">depths</span>,
                      <span class="kw">longname</span> <span class="kw">=</span> <span class="st">'Depth from surface'</span>)
<span class="no">timedim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span>(<span class="st">"timestep"</span>,
                     <span class="kw">units</span> <span class="kw">=</span> <span class="st">'1 day'</span>,
                     <span class="kw">longname</span> <span class="kw">=</span> <span class="st">'timestep'</span>,
                     <span class="kw">vals</span> <span class="kw">=</span> <span class="no">timestep</span>)

<span class="no">dimnchar</span>   <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncdim_def.html">ncdim_def</a></span>(<span class="st">"nchar"</span>,   <span class="st">""</span>,
                        <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">time</span>[<span class="fl">1</span>])),
                        <span class="kw">create_dimvar</span><span class="kw">=</span><span class="fl">FALSE</span>)

<span class="co">#Define variables</span>
<span class="no">fillvalue</span> <span class="kw">&lt;-</span> <span class="fl">1e32</span>

<span class="no">def_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">def_list</span><span class="kw">[[</span><span class="fl">1</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"time"</span>,
                           <span class="kw">units</span> <span class="kw">=</span> <span class="st">"datetime"</span>,
                           <span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">dimnchar</span>, <span class="no">timedim</span>),
                           <span class="kw">longname</span> <span class="kw">=</span> <span class="st">"time"</span>,
                           <span class="kw">prec</span><span class="kw">=</span><span class="st">"char"</span>)
<span class="no">def_list</span><span class="kw">[[</span><span class="fl">2</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span>(<span class="kw">name</span> <span class="kw">=</span>  <span class="st">"species_1"</span>,
                           <span class="kw">units</span> <span class="kw">=</span> <span class="st">"number of individuals"</span>,
                           <span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">timedim</span>, <span class="no">depthdim</span>, <span class="no">ensdim</span>),
                           <span class="kw">missval</span> <span class="kw">=</span> <span class="no">fillvalue</span>,
                           <span class="kw">longname</span> <span class="kw">=</span> <span class="st">'temperature_mean'</span>,
                           <span class="kw">prec</span><span class="kw">=</span><span class="st">"single"</span>)
<span class="no">def_list</span><span class="kw">[[</span><span class="fl">3</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span>(<span class="kw">name</span> <span class="kw">=</span>  <span class="st">"species_2"</span>,
                           <span class="kw">units</span> <span class="kw">=</span> <span class="st">"number of individuals"</span>,
                           <span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">timedim</span>, <span class="no">depthdim</span>, <span class="no">ensdim</span>),
                           <span class="kw">missval</span> <span class="kw">=</span> <span class="no">fillvalue</span>,
                           <span class="kw">longname</span> <span class="kw">=</span> <span class="st">'temperature_mean'</span>,
                           <span class="kw">prec</span><span class="kw">=</span><span class="st">"single"</span>)
<span class="no">def_list</span><span class="kw">[[</span><span class="fl">4</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_def.html">ncvar_def</a></span>(<span class="kw">name</span> <span class="kw">=</span>  <span class="st">"data_assimilation"</span>,
                           <span class="kw">units</span> <span class="kw">=</span> <span class="st">"logical"</span>,
                           <span class="kw">dim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">timedim</span>),
                           <span class="kw">missval</span> <span class="kw">=</span> <span class="no">fillvalue</span>,
                           <span class="kw">longname</span> <span class="kw">=</span> <span class="st">'1 = data assimilation used in timestep'</span>,
                           <span class="kw">prec</span><span class="kw">=</span><span class="st">"single"</span>)

<span class="no">ncout</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_create.html">nc_create</a></span>(<span class="no">ncfname</span>,<span class="no">def_list</span>,<span class="kw">force_v4</span><span class="kw">=</span><span class="no">T</span>)

<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span>(<span class="no">ncout</span>,<span class="no">def_list</span><span class="kw">[[</span><span class="fl">1</span>]] , <span class="no">time</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span>(<span class="no">ncout</span>,<span class="no">def_list</span><span class="kw">[[</span><span class="fl">2</span>]] , <span class="no">n</span>[<span class="fl">1</span>, , , ])
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span>(<span class="no">ncout</span>,<span class="no">def_list</span><span class="kw">[[</span><span class="fl">3</span>]] , <span class="no">n</span>[<span class="fl">2</span>, , , ])
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ancvar_put.html">ncvar_put</a></span>(<span class="no">ncout</span>,<span class="no">def_list</span><span class="kw">[[</span><span class="fl">4</span>]] , <span class="no">data_assimilation</span>)

<span class="co">#Global file metadata</span>
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncatt_put.html">ncatt_put</a></span>(<span class="no">ncout</span>,<span class="fl">0</span>,<span class="st">"ForecastProject_id"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">ForecastProject_id</span>),
          <span class="kw">prec</span> <span class="kw">=</span>  <span class="st">"text"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncatt_put.html">ncatt_put</a></span>(<span class="no">ncout</span>,<span class="fl">0</span>,<span class="st">"Forecast_id"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">Forecast_id</span>),
          <span class="kw">prec</span> <span class="kw">=</span>  <span class="st">"text"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncatt_put.html">ncatt_put</a></span>(<span class="no">ncout</span>,<span class="fl">0</span>,<span class="st">"forecast_issue_time"</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">forecast_issue_time</span>),
          <span class="kw">prec</span> <span class="kw">=</span>  <span class="st">"text"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_close.html">nc_close</a></span>(<span class="no">ncout</span>)</pre></body></html></div>
</div>
<div id="standard-option-2-ensemble-csv" class="section level1">
<h1 class="hasAnchor">
<a href="#standard-option-2-ensemble-csv" class="anchor"></a>Standard Option 2: ensemble CSV</h1>
<p>Convert to a flat file format (CSV) with one column for each variable and all ensemble members saved</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fl">2000</span> + <span class="fl">1</span>:<span class="no">NT</span>), <span class="kw">format</span> <span class="kw">=</span> <span class="st">"%Y"</span>)
<span class="no">state_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"species_1"</span>, <span class="st">"species_2"</span>)
<span class="no">n_states</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">state_names</span>)
<span class="no">states</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">n</span>[<span class="fl">1</span>, , , ], <span class="no">n</span>[<span class="fl">2</span>, , ,])

<span class="co">#No data assimilation was used for any of forecast results archived</span>

<span class="no">df_combined</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()

<span class="kw">for</span>(<span class="no">k</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_states</span>){
  <span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">n_depths</span>){
    <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu">as_tibble</span>(<span class="no">states</span><span class="kw">[[</span><span class="no">k</span>]][, ,<span class="no">i</span>])
    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">df</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">states</span><span class="kw">[[</span><span class="no">k</span>]][, ,<span class="no">i</span>])))
    <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">time</span>, <span class="no">df</span>, <span class="no">data_assimilation</span>)
    <span class="no">df</span> <span class="kw">&lt;-</span> <span class="no">df</span> <span class="kw">%&gt;%</span>
      <span class="fu">pivot_longer</span>(<span class="kw">cols</span> <span class="kw">=</span> -<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">time</span>,<span class="no">data_assimilation</span>),
                   <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"ensemble"</span>,
                   <span class="kw">values_to</span> <span class="kw">=</span> <span class="no">state_names</span>[<span class="no">k</span>]) <span class="kw">%&gt;%</span>
      <span class="fu">mutate</span>(<span class="kw">ensemble</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">ensemble</span>)) <span class="kw">%&gt;%</span>
      <span class="fu">mutate</span>(<span class="kw">depth</span> <span class="kw">=</span> <span class="no">depths</span>[<span class="no">i</span>])
    <span class="kw">if</span>(<span class="no">i</span> <span class="kw">==</span> <span class="fl">1</span>){
      <span class="no">running_df</span> <span class="kw">&lt;-</span> <span class="no">df</span>
    }<span class="kw">else</span>{
      <span class="no">running_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">running_df</span>, <span class="no">df</span>)
    }
  }
  <span class="no">df_combined</span><span class="kw">[[</span><span class="no">k</span>]] <span class="kw">&lt;-</span> <span class="no">running_df</span>
}</pre></body></html></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">df_combined</span> <span class="kw">&lt;-</span> <span class="fu">right_join</span>(<span class="no">df_combined</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="no">df_combined</span><span class="kw">[[</span><span class="fl">2</span>]],
                          <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"time"</span>, <span class="st">"ensemble"</span>, <span class="st">"depth"</span>, <span class="st">"data_assimilation"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">forecast_issue_time</span> <span class="kw">=</span> <span class="no">forecast_issue_time</span>,
         <span class="kw">Forecast_id</span> <span class="kw">=</span> <span class="no">Forecast_id</span>,
         <span class="kw">ForecastProject_id</span> <span class="kw">=</span> <span class="no">ForecastProject_id</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">time</span>, <span class="no">depth</span>, <span class="no">ensemble</span>, <span class="no">state_names</span>[<span class="fl">1</span>],
         <span class="no">state_names</span>[<span class="fl">2</span>], <span class="no">forecast_issue_time</span>,
         <span class="no">data_assimilation</span>, <span class="no">ForecastProject_id</span>, <span class="no">Forecast_id</span>)

<span class="no">df_combined</span></pre></body></html></div>
<pre><code>## # A tibble: 270 x 9
##    time       depth ensemble species_1 species_2 forecast_issue_…
##    &lt;date&gt;     &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;date&gt;          
##  1 2001-05-05     1        1     0.5        0.5  2001-03-04      
##  2 2001-05-05     1        2     0.5        0.5  2001-03-04      
##  3 2001-05-05     1        3     0.5        0.5  2001-03-04      
##  4 2002-05-05     1        1     0.984      1.95 2001-03-04      
##  5 2002-05-05     1        2     0.967      1.93 2001-03-04      
##  6 2002-05-05     1        3     0.972      1.95 2001-03-04      
##  7 2003-05-05     1        1     1.83       7.13 2001-03-04      
##  8 2003-05-05     1        2     1.82       7.09 2001-03-04      
##  9 2003-05-05     1        3     1.82       7.15 2001-03-04      
## 10 2004-05-05     1        1     3.05      20.3  2001-03-04      
## # … with 260 more rows, and 3 more variables: data_assimilation &lt;dbl&gt;,
## #   ForecastProject_id &lt;dbl&gt;, Forecast_id &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(<span class="no">df_combined</span>,
          <span class="kw">file</span> <span class="kw">=</span> <span class="st">"logistic-forecast-ensemble-multi-variable-multi-depth.csv"</span>)</pre></body></html></div>
</div>
<div id="standard-option-3-summary-csv" class="section level1">
<h1 class="hasAnchor">
<a href="#standard-option-3-summary-csv" class="anchor"></a>Standard Option 3: summary CSV</h1>
<p>Convert to a flat file format (CSV) with forecast distribution summaries saved</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">df_species_1</span> <span class="kw">&lt;-</span> <span class="no">df_combined</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">species_2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">time</span>, <span class="no">depth</span>, <span class="no">forecast_issue_time</span>, <span class="no">data_assimilation</span>,
           <span class="no">ForecastProject_id</span>, <span class="no">Forecast_id</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">species_1</span>),
            <span class="kw">Conf_interv_02.5</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">species_1</span>, <span class="fl">0.025</span>),
            <span class="kw">Conf_interv_97.5</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">species_1</span>, <span class="fl">0.975</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mean"</span>,<span class="st">"Conf_interv_02.5"</span>,<span class="st">"Conf_interv_97.5"</span>),
               <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Statistic"</span>,
               <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"species_1"</span>)

<span class="no">df_species_2</span> <span class="kw">&lt;-</span> <span class="no">df_combined</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">species_1</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">time</span>, <span class="no">depth</span>, <span class="no">forecast_issue_time</span>, <span class="no">data_assimilation</span>,
           <span class="no">ForecastProject_id</span>, <span class="no">Forecast_id</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">species_2</span>),
            <span class="kw">Conf_interv_02.5</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">species_2</span>, <span class="fl">0.025</span>),
            <span class="kw">Conf_interv_97.5</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">species_2</span>, <span class="fl">0.975</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mean"</span>,<span class="st">"Conf_interv_02.5"</span>,<span class="st">"Conf_interv_97.5"</span>),
               <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"Statistic"</span>,
               <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"species_2"</span>)

 <span class="no">df_summary</span> <span class="kw">&lt;-</span> <span class="fu">right_join</span>(<span class="no">df_species_1</span>, <span class="no">df_species_2</span>)</pre></body></html></div>
<pre><code>## Joining, by = c("time", "depth", "forecast_issue_time", "data_assimilation", "ForecastProject_id", "Forecast_id", "Statistic")</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"> <span class="no">df_summary</span></pre></body></html></div>
<pre><code>## # A tibble: 270 x 9
## # Groups:   time, depth, forecast_issue_time, data_assimilation,
## #   ForecastProject_id [90]
##    time       depth forecast_issue_… data_assimilati… ForecastProject…
##    &lt;date&gt;     &lt;int&gt; &lt;date&gt;                      &lt;dbl&gt;            &lt;dbl&gt;
##  1 2001-05-05     1 2001-03-04                      0         30405043
##  2 2001-05-05     1 2001-03-04                      0         30405043
##  3 2001-05-05     1 2001-03-04                      0         30405043
##  4 2001-05-05     2 2001-03-04                      0         30405043
##  5 2001-05-05     2 2001-03-04                      0         30405043
##  6 2001-05-05     2 2001-03-04                      0         30405043
##  7 2001-05-05     3 2001-03-04                      0         30405043
##  8 2001-05-05     3 2001-03-04                      0         30405043
##  9 2001-05-05     3 2001-03-04                      0         30405043
## 10 2002-05-05     1 2001-03-04                      0         30405043
## # … with 260 more rows, and 4 more variables: Forecast_id &lt;chr&gt;,
## #   Statistic &lt;chr&gt;, species_1 &lt;dbl&gt;, species_2 &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(<span class="no">df_summary</span>,
          <span class="kw">file</span> <span class="kw">=</span> <span class="st">"logistic-forecast-summary-multi-variable-multi-depth.csv"</span>)</pre></body></html></div>
<div id="standardized-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#standardized-metadata" class="anchor"></a>Standardized Metadata</h2>
<p>Let’s document the metadata of the data table itself. It may well be that we decide an Ecological Forecast has to have specific columns like the ones described above, which would thus correspond to a partially pre-defined attributes table (e.g. the units would probably still be allowed to vary, but format would be the same.)</p>
<p>Note one weakness of this format is that it assumes all data in a column have the same units. This common assumption might be violoated by transformations to “long” form data, where you have columns like “variable”, “value”, and “units”. (The long form may be useful, but it exposes much less information in the metadata layer – e.g. we no longer know what’s actually being measured without looking at the data file itself).</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">attributes</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">attributeName</span>, ~<span class="no">attributeDefinition</span>, ~<span class="no">unit</span>, ~<span class="no">formatString</span>, ~<span class="no">numberType</span>, ~<span class="no">definition</span>,
  <span class="st">"time"</span>,          <span class="st">"time"</span>,                       <span class="st">"year"</span>,     <span class="st">"YYYY-MM-DD"</span>, <span class="st">"numberType"</span>, <span class="fl">NA</span>,
  <span class="st">"depth"</span>,         <span class="st">"depth in reservior"</span>,         <span class="st">"meter"</span>,   <span class="fl">NA</span>,          <span class="st">"real"</span>, <span class="fl">NA</span>,
  <span class="st">"ensemble"</span>,      <span class="st">"index of ensemble member"</span>,   <span class="st">"dimensionless"</span>,    <span class="fl">NA</span>,         <span class="st">"integer"</span>, <span class="fl">NA</span>,
  <span class="st">"species_1"</span>,     <span class="st">"Population size of species 1"</span>, <span class="st">"numberPerMeterSquared"</span>, <span class="fl">NA</span>,  <span class="st">"real"</span>, <span class="fl">NA</span>,
  <span class="st">"species_2"</span>,     <span class="st">"Population size of species 2"</span>, <span class="st">"numberPerMeterSquared"</span>, <span class="fl">NA</span>,  <span class="st">"real"</span>, <span class="fl">NA</span>,
  <span class="st">"forecast_issue_time"</span>,     <span class="st">"time that forecast was created"</span>, <span class="fl">NA</span>, <span class="st">"YYYY-MM-DD"</span>,  <span class="fl">NA</span>, <span class="fl">NA</span>,
  <span class="st">"data_assimilation"</span>,     <span class="st">"Flag whether time step included data assimilation"</span>, <span class="st">"dimensionless"</span>, <span class="fl">NA</span>, <span class="st">"integer"</span>, <span class="fl">NA</span>,
  <span class="st">"Forecast_id"</span>,     <span class="st">"ID for specific forecast cycle"</span>, <span class="fl">NA</span>, <span class="fl">NA</span>,  <span class="fl">NA</span>, <span class="st">"forecast id"</span>,
  <span class="st">"ForecastProject_id"</span>,     <span class="st">"ID for forecasting project"</span>, <span class="fl">NA</span>, <span class="fl">NA</span>,  <span class="fl">NA</span>, <span class="st">"project id"</span>
)
<span class="no">attrList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/set_attributes.html">set_attributes</a></span>(<span class="no">attributes</span>,
                           <span class="kw">col_classes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Date"</span>, <span class="st">"numeric"</span>, <span class="st">"numeric"</span>,
                                           <span class="st">"numeric"</span>,<span class="st">"numeric"</span>, <span class="st">"Date"</span>,
                                           <span class="st">"numeric"</span>, <span class="st">"character"</span>, <span class="st">"character"</span>))
<span class="no">physical</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/set_physical.html">set_physical</a></span>(<span class="st">"logistic-forecast-ensemble-multi-variable-multi-depth.csv"</span>)</pre></body></html></div>
<pre><code>## Automatically calculated file size using file.size("logistic-forecast-ensemble-multi-variable-multi-depth.csv")</code></pre>
<pre><code>## Automatically calculated authentication size using digest::digest("logistic-forecast-ensemble-multi-variable-multi-depth.csv", algo = "md5", file = TRUE)</code></pre>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">dataTable</span> <span class="kw">&lt;-</span> <span class="no">eml</span>$<span class="fu">dataTable</span>(
                 <span class="kw">entityName</span> <span class="kw">=</span> <span class="st">"logistic-forecast-ensemble-multi-variable-multi-depth.csv"</span>,
                 <span class="kw">entityDescription</span> <span class="kw">=</span> <span class="st">"Forecast of population size using a depth specific model"</span>,
                 <span class="kw">physical</span> <span class="kw">=</span> <span class="no">physical</span>,
                 <span class="kw">attributeList</span> <span class="kw">=</span> <span class="no">attrList</span>)</pre></body></html></div>
<p>There’s a lot more optional terminology that could be exploited here – for instance, the specification lets us define different missing value codes (and explanations) for each column, and allows us to indicate <code>precision</code>, <code>minimum</code> and <code>maximum</code>.</p>
<p>Note that <code>physical</code> type can document almost any formats as well, including NetCDF etc. A NetCDF file would still document the variables measured in much the same way regardless of the underlying representation. Note that</p>
<p>Now that we’ve documented the actual data.frame itself, we can add additional metadata to the record describing our forecast, which is essential for citing, discovering, and interpreting the result. We start with some authorship information.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">me</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">individualName</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">givenName</span> <span class="kw">=</span> <span class="st">"Quinn"</span>,
                                 <span class="kw">surName</span> <span class="kw">=</span> <span class="st">"Thomas"</span>),
           <span class="kw">electronicMailAddress</span> <span class="kw">=</span> <span class="st">"rqthomas@vt.edu"</span>,
           <span class="kw">id</span> <span class="kw">=</span> <span class="st">"https://orcid.org/0000-0003-1282-7825"</span>)</pre></body></html></div>
<p>Set Taxonomic, Temporal, and Geographic Coverage. (Look, apparently we’re modeling population densities of <em>Sarracenia purpurea</em> in Harvard Forest starting in about 2012!)</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">coverage</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://docs.ropensci.org/EML/reference/set_coverage.html">set_coverage</a></span>(<span class="kw">begin</span> <span class="kw">=</span> <span class="st">'2012-06-01'</span>,
               <span class="kw">end</span> <span class="kw">=</span> <span class="st">'2013-12-31'</span>,
               <span class="kw">sci_names</span> <span class="kw">=</span> <span class="st">"Sarracenia purpurea"</span>,
               <span class="kw">geographicDescription</span> <span class="kw">=</span> <span class="st">"Harvard Forest Greenhouse, Tom Swamp Tract (Harvard Forest)"</span>,
               <span class="kw">west</span> <span class="kw">=</span> -<span class="fl">122.44</span>, <span class="kw">east</span> <span class="kw">=</span> -<span class="fl">117.15</span>,
               <span class="kw">north</span> <span class="kw">=</span> <span class="fl">37.38</span>, <span class="kw">south</span> <span class="kw">=</span> <span class="fl">30.00</span>,
               <span class="kw">altitudeMin</span> <span class="kw">=</span> <span class="fl">160</span>, <span class="kw">altitudeMaximum</span> <span class="kw">=</span> <span class="fl">330</span>,
               <span class="kw">altitudeUnits</span> <span class="kw">=</span> <span class="st">"meter"</span>)</pre></body></html></div>
<p>Set key words. We will need to develop a EFI controlled vocabulary</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">keywordSet</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">keywordThesaurus</span> <span class="kw">=</span> <span class="st">"EFI controlled vocabulary"</span>,
        <span class="kw">keyword</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"forecast"</span>,
                    <span class="st">"population"</span>,
                    <span class="st">"timeseries"</span>)
    ))</pre></body></html></div>
<p>Our dataset needs an abstract describing what this is all about. Also, a methods section is not required but it’s probably a good idea.</p>
<p>We envision having additional required metadata sections. However, we need to figure out the formatting of the Markdown file so that it is represented cleanly in the EML.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">additionalMetadata</span> <span class="kw">&lt;-</span> <span class="no">eml</span>$<span class="fu">additionalMetadata</span>(
  <span class="co">#  describes="forecast",  ## not sure how to find the correct ID for this to be valid</span>
  <span class="kw">metadata</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">forecast</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
      <span class="kw">timestep</span> <span class="kw">=</span> <span class="st">"1 year"</span>, <span class="co">## should be udunits parsable; already in coverage -&gt; temporalCoverage?</span>
      <span class="kw">forecast_horizon</span> <span class="kw">=</span> <span class="st">"30 years"</span>,
      <span class="kw">initial_conditions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="co"># Possible values: no, contains, data_driven, propagates, assimilates</span>
        <span class="kw">uncertainty</span> <span class="kw">=</span> <span class="st">"contains"</span>,
        <span class="co"># Number of parameters / dimensionality</span>
        <span class="kw">complexity</span> <span class="kw">=</span> <span class="fl">2</span>
      ),
      <span class="kw">parameters</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">uncertainty</span> <span class="kw">=</span> <span class="st">"contains"</span>,
        <span class="kw">complexity</span> <span class="kw">=</span> <span class="fl">3</span>
      ),
      <span class="kw">random_effects</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">uncertainty</span> <span class="kw">=</span> <span class="st">"no"</span>
      ),
      <span class="kw">process_error</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">uncertainty</span> <span class="kw">=</span> <span class="st">"propagates"</span>,
        <span class="kw">propagation</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
          <span class="kw">type</span> <span class="kw">=</span> <span class="st">"ensemble"</span>, <span class="co"># ensemble vs analytic</span>
          <span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>          <span class="co"># required if ensemble</span>
        ),
        <span class="kw">complexity</span> <span class="kw">=</span> <span class="fl">2</span>,
        <span class="kw">covariance</span> <span class="kw">=</span> <span class="fl">FALSE</span>
      ),
      <span class="kw">drivers</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">uncertainty</span> <span class="kw">=</span> <span class="st">"no"</span>
      )
      <span class="co"># assimilation_method ## required if any uncertainty = assimilates</span>
    ) <span class="co"># forecast</span>
  ) <span class="co"># metadata</span>
) <span class="co"># eml$additionalMetadata</span></pre></body></html></div>
<p><strong>Model Description</strong></p>
<ul>
<li>Type of model (Empirical, process-based, machine learning): Process-based</li>
<li>Model name: discrete Lotka–Volterra model</li>
<li>Location of repository with model code: <a href="https://github.com/somewhere" class="uri">https://github.com/somewhere</a> or <a href="https://doi.org/10.xxx" class="uri">https://doi.org/10.xxx</a>
</li>
<li>Model citation: N/A</li>
<li>Total number of model process parameters: 3</li>
</ul>
<p><strong>Model Covariates</strong></p>
<ul>
<li>Type (i.e., meteorology): N/A</li>
<li>Source (i.e., NOAA GEFS): N/A</li>
</ul>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">abstract</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">markdown</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="st">"abstract.md"</span>), <span class="kw">collapse</span> <span class="kw">=</span> <span class="st">"\n"</span>))</pre></body></html></div>
<pre><code>## Warning in readLines("abstract.md"): incomplete final line found on
## 'abstract.md'</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">methods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">id</span><span class="kw">=</span><span class="st">"forecast"</span>,<span class="kw">methodStep</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">description</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">markdown</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="st">"methods.md"</span>), <span class="kw">collapse</span> <span class="kw">=</span> <span class="st">"\n"</span>))))  <span class="co">## to be dropped</span></pre></body></html></div>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">dataset</span> <span class="kw">=</span> <span class="no">eml</span>$<span class="fu">dataset</span>(
               <span class="kw">title</span> <span class="kw">=</span> <span class="st">"A very silly logistic forecast"</span>,
               <span class="kw">creator</span> <span class="kw">=</span> <span class="no">me</span>,
               <span class="kw">contact</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">references</span><span class="kw">=</span><span class="st">"https://orcid.org/0000-0003-1282-7825"</span>),
               <span class="kw">pubDate</span> <span class="kw">=</span> <span class="no">forecast_issue_time</span>,
               <span class="kw">intellectualRights</span> <span class="kw">=</span> <span class="st">"http://www.lternet.edu/data/netpolicy.html."</span>,
               <span class="kw">abstract</span> <span class="kw">=</span>  <span class="st">"An illustration of how we might use EML metadata to describe an ecological forecast"</span>,
               <span class="kw">dataTable</span> <span class="kw">=</span> <span class="no">dataTable</span>,
               <span class="kw">keywordSet</span> <span class="kw">=</span> <span class="no">keywordSet</span>,
               <span class="kw">coverage</span> <span class="kw">=</span> <span class="no">coverage</span>,
               <span class="kw">methods</span> <span class="kw">=</span> <span class="no">methods</span>
               )</pre></body></html></div>
<p>All we need now is to add a unique identifier for the project and we are good to go! This could be a DOI or merely an identifier we create, e.g. a UUID.</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">my_eml</span> <span class="kw">&lt;-</span> <span class="no">eml</span>$<span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml.html">eml</a></span>(<span class="kw">dataset</span> <span class="kw">=</span> <span class="no">dataset</span>,
           <span class="kw">additionalMetadata</span> <span class="kw">=</span> <span class="no">additionalMetadata</span>,
           <span class="kw">packageId</span> <span class="kw">=</span> <span class="no">Forecast_id</span>,  <span class="co">#Is this the ForecastProject_ID?</span>
           <span class="co">#What about the Forecast_ID</span>
           <span class="kw">system</span> <span class="kw">=</span> <span class="st">"uuid"</span>
           )</pre></body></html></div>
<p>Once we have finished building our EML metadata, we can confirm it is valid.<br>
This will catch any missing elements. (Recall that what is ‘required’ depends on what you include – for example, you don’t have to document a <code>dataTable</code> at all, but if you do, you have to document the “physical” file format it is in<br>
(e.g. <code>csv</code>) and the attributes and units it uses!)</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_validate.html">eml_validate</a></span>(<span class="no">my_eml</span>)</pre></body></html></div>
<pre><code>## [1] TRUE
## attr(,"errors")
## character(0)</code></pre>
<p>We are now ready to write out a valid EML document:</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/write_eml.html">write_eml</a></span>(<span class="no">my_eml</span>, <span class="st">"forecast-eml.xml"</span>)</pre></body></html></div>
<pre><code>## NULL</code></pre>
<p>At this point, we could easily upload this metadata along with the data itself to DataONE via the API (or <code>dataone</code> R package.)</p>
<p>We can also generate a JSON-LD version of EML:</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="kw pkg">emld</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/emld/reference/as_json.html">as_json</a></span>(<span class="fu"><a href="https://docs.ropensci.org/EML/reference/reexports.html">as_emld</a></span>(<span class="st">"forecast-eml.xml"</span>), <span class="kw">file</span> <span class="kw">=</span> <span class="st">"forecast-eml.json"</span>)</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Carl Boettiger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
